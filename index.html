<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Conversor Wise</title>
  
  <!-- PWA Meta Tags -->
  <meta name="description" content="Calculadora para convers√µes de moeda usando Wise - Calcule suas convers√µes para Orlando" />
  <meta name="theme-color" content="#667eea" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Conversor Wise" />
  <meta name="apple-touch-fullscreen" content="yes" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-orientations" content="portrait" />
  <meta name="msapplication-TileColor" content="#667eea" />
  <meta name="msapplication-config" content="browserconfig.xml" />
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/CalculadoraWise/manifest.json" />
  
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="72x72" href="/CalculadoraWise/icons/icon-72x72.png" />
  <link rel="apple-touch-icon" sizes="96x96" href="/CalculadoraWise/icons/icon-96x96.png" />
  <link rel="apple-touch-icon" sizes="128x128" href="/CalculadoraWise/icons/icon-128x128.png" />
  <link rel="apple-touch-icon" sizes="144x144" href="/CalculadoraWise/icons/icon-144x144.png" />
  <link rel="apple-touch-icon" sizes="152x152" href="/CalculadoraWise/icons/icon-152x152.png" />
  <link rel="apple-touch-icon" sizes="192x192" href="/CalculadoraWise/icons/icon-192x192.png" />
  <link rel="apple-touch-icon" sizes="384x384" href="/CalculadoraWise/icons/icon-384x384.png" />
  <link rel="apple-touch-icon" sizes="512x512" href="/CalculadoraWise/icons/icon-512x512.png" />
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="16x16" href="/CalculadoraWise/icons/icon-72x72.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/CalculadoraWise/icons/icon-72x72.png" />
  <link rel="icon" type="image/png" sizes="48x48" href="/CalculadoraWise/icons/icon-96x96.png" />
  <link rel="icon" type="image/png" sizes="96x96" href="/CalculadoraWise/icons/icon-96x96.png" />
  <link rel="icon" type="image/png" sizes="128x128" href="/CalculadoraWise/icons/icon-128x128.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="/CalculadoraWise/icons/icon-192x192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="/CalculadoraWise/icons/icon-512x512.png" />
  <!-- Favicon tradicional (opcional) -->
  <link rel="shortcut icon" href="/CalculadoraWise/icons/icon-32x32.png" />
  <link rel="icon" type="image/x-icon" href="/CalculadoraWise/icons/icon-32x32.ico" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 0;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      /* Safe area para iOS */
      padding-top: var(--sat, 0px);
      padding-bottom: var(--sab, 0px);
      padding-left: var(--sal, 0px);
      padding-right: var(--sar, 0px);
    }
    
    .app-container {
      max-width: 100%;
      margin: 0 auto;
      background: #f8f9fa;
      min-height: 100vh;
      position: relative;
      box-shadow: 0 0 30px rgba(0,0,0,0.3);
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 20px 20px 30px;
      color: white;
      text-align: center;
      border-radius: 0 0 25px 25px;
      margin-bottom: 20px;
    }
    
    .header h1 {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .header-logo {
      width: 28px;
      height: 28px;
      object-fit: contain;
      vertical-align: middle;
    }
    
    .header p {
      font-size: 16px;
      opacity: 0.9;
      font-weight: 400;
    }
    
    .tabs {
      display: flex;
      margin: 0 20px 25px;
      background: white;
      border-radius: 16px;
      padding: 4px;
      box-shadow: 0 2px 20px rgba(0,0,0,0.08);
    }
    
    .tab-button {
      flex: 1;
      padding: 16px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 12px;
      font-size: 20px;
      font-weight: 600;
      color: #6c757d;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    
    .tab-button.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    .tab-content {
      display: none;
      padding: 0 20px;
      animation: fadeIn 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .card {
      background: white;
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 4px 25px rgba(0,0,0,0.08);
      border: 1px solid rgba(255,255,255,0.8);
    }
    
    .input-group {
      margin-bottom: 20px;
    }
    
    .input-group:last-child {
      margin-bottom: 0;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c3e50;
      font-size: 16px;
    }
    
    .input-container {
      position: relative;
    }
    
    input {
      width: 100%;
      padding: 18px 20px;
      border: 2px solid #e9ecef;
      border-radius: 16px;
      font-size: 18px;
      font-weight: 500;
      background: #f8f9fa;
      transition: all 0.3s ease;
      -webkit-appearance: none;
      appearance: none;
      /* Corre√ß√µes para iOS */
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: text;
      user-select: text;
      /* For√ßar teclado num√©rico no iOS */
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }
    
    input:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      animation: inputFocus 0.3s ease;
    }
    
    /* Corre√ß√µes espec√≠ficas para iOS */
    input[type="number"] {
      -webkit-appearance: none;
      appearance: none;
      -moz-appearance: textfield;
    }
    
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      appearance: none;
      margin: 0;
    }
    
    /* For√ßar teclado num√©rico no iOS */
    input[type="number"] {
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }
    
    /* Corre√ß√£o para viewport no iOS */
    @supports (-webkit-touch-callout: none) {
      .app-container {
        min-height: -webkit-fill-available;
      }
      
      body {
        min-height: -webkit-fill-available;
      }
      
      /* Corre√ß√µes espec√≠ficas para PWA no iOS */
      input[type="number"] {
        -webkit-appearance: none;
        appearance: none;
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        -webkit-user-select: text;
        user-select: text;
        font-size: 16px; /* Previne zoom no iOS */
      }
      
      /* For√ßar teclado num√©rico no iOS PWA */
      input[type="number"]:focus {
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
        transform: translateZ(0);
      }
    }
    
    @keyframes inputFocus {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
    
    .currency-symbol {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: #6c757d;
      font-weight: 600;
      font-size: 18px;
      pointer-events: none;
    }
    
    .currency-input {
      padding-left: 60px;
      padding-right: 50px;
    }
    
    .refresh-btn {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      width: 35px;
      height: 35px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }
    
    .refresh-btn:hover {
      transform: translateY(-50%) scale(1.1);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .refresh-btn:active {
      transform: translateY(-50%) scale(0.95);
    }
    
    .refresh-btn.loading {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      from { transform: translateY(-50%) rotate(0deg); }
      to { transform: translateY(-50%) rotate(360deg); }
    }
    
    .result {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      padding: 25px;
      border-radius: 20px;
      margin-top: 25px;
      border: 1px solid rgba(102, 126, 234, 0.1);
    }
    
    .result-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      font-size: 18px;
      font-weight: 700;
      color: #2c3e50;
    }
    
    .result-icon {
      font-size: 24px;
      margin-right: 10px;
    }
    
    .result-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid rgba(108, 117, 125, 0.1);
      font-size: 16px;
    }
    
    .result-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }
    
    .result-label {
      color: #6c757d;
      font-weight: 500;
    }
    
    .result-value {
      font-weight: 700;
      color: #2c3e50;
    }
    
    .result-final {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 16px;
      margin-top: 15px;
      text-align: center;
    }
    
    .result-final-label {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .result-final-value {
      font-size: 28px;
      font-weight: 800;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .highlight {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      padding: 15px;
      border-radius: 12px;
      margin-top: 10px;
    }
    
    .highlight-title {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 5px;
    }
    
    .highlight-value {
      font-size: 18px;
      font-weight: 700;
    }
    
    .conversion-selector {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }
    
    .conversion-btn {
      flex: 1;
      padding: 14px 16px;
      border: 2px solid #e9ecef;
      background: #f8f9fa;
      border-radius: 12px;
      font-size: 19px;
      font-weight: 600;
      color: #6c757d;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .conversion-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #667eea;
      box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
    }
    
    .conversion-btn:hover:not(.active) {
      border-color: #667eea;
      background: white;
    }
    
    .footer {
      padding: 30px 20px;
      text-align: center;
      color: #6c757d;
      font-size: 14px;
    }
    
    /* Haptic feedback simulation */
    .tab-button:active {
      transform: scale(0.98);
    }
    
    .error-message {
      color: #dc3545;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
    
    input.error {
      border-color: #dc3545;
      background: #fff5f5;
    }
    
    @media (max-width: 400px) {
      .app-container {
        max-width: 100%;
      }
      
      .tabs {
        margin: 0 15px 20px;
      }
      
      .tab-content {
        padding: 0 15px;
      }
      
      .card {
        padding: 20px;
      }
    }
    
    .calculate-btn {
      width: 100%;
      padding: 18px 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 16px;
      font-size: 22px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 10px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .calculate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    
    .calculate-btn:active {
      transform: translateY(0);
    }
    
    .calculate-btn:disabled {
      background: #6c757d;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <h1><img src="/CalculadoraWise/icons/logo.png" alt="Logo" class="header-logo"> Conversor Wise</h1>
      <p>Calcule suas convers√µes para Orlando</p>
    </div>

    <div class="tabs" role="tablist">
      <button class="tab-button active" onclick="openTab('envio')" role="tab" aria-selected="true" aria-controls="envio">
        <span>üí≥</span> Convers√£o
      </button>
      <button class="tab-button" onclick="openTab('produto')" role="tab" aria-selected="false" aria-controls="produto">
        <span>üõí</span> Comprar
      </button>
    </div>

    <!-- Aba 1: Convers√£o com op√ß√£o de dire√ß√£o -->
    <div id="envio" class="tab-content active" role="tabpanel">
      <div class="card">
        <div class="input-group">
          <label>Tipo de convers√£o</label>
          <div class="conversion-selector">
            <button class="conversion-btn active" id="brl-to-usd" onclick="setConversionType('brl-to-usd')" aria-label="Converter de Real para D√≥lar">
              BRL ‚Üí USD
            </button>
            <button class="conversion-btn" id="usd-to-brl" onclick="setConversionType('usd-to-brl')" aria-label="Converter de D√≥lar para Real">
               USD ‚Üí BRL
            </button>
          </div>
        </div>

        <div class="input-group" id="input-brl-to-usd">
          <label for="valorBRL">Valor em reais para enviar</label>
          <div class="input-container">
            <span class="currency-symbol">R$</span>
            <input type="number" id="valorBRL" class="currency-input" placeholder="1.000,00" min="0" step="0.01" />
          </div>
          <div class="error-message" id="error-valorBRL">Por favor, insira um valor v√°lido maior que zero.</div>
        </div>

        <div class="input-group" id="input-usd-to-brl" style="display: none;">
          <label for="valorUSDDesejado">Valor em d√≥lares desejado</label>
          <div class="input-container">
            <span class="currency-symbol">US$</span>
            <input type="number" id="valorUSDDesejado" class="currency-input" placeholder=" 100,00" min="0" step="0.01" />
          </div>
          <div class="error-message" id="error-valorUSDDesejado">Por favor, insira um valor v√°lido maior que zero.</div>
        </div>

        <div class="input-group">
          <label for="cotacaoEnvio">Cota√ß√£o do d√≥lar</label>
          <div class="input-container">
            <span class="currency-symbol">R$</span>
            <input type="text" id="cotacaoEnvio" class="currency-input" value="5.36" />
            <button type="button" id="refreshCotacao" class="refresh-btn" onclick="buscarCotacaoDolar()" title="Atualizar cota√ß√£o do d√≥lar">
              üîÑ
            </button>
          </div>
          <div class="error-message" id="error-cotacaoEnvio">Por favor, insira uma cota√ß√£o v√°lida maior que zero.</div>
        </div>
        
        <button class="calculate-btn" onclick="calcularConversao()">
          Calcular
        </button>
      </div>

      <div class="result" id="resultadoEnvio" style="display: none;">
        <div class="result-header">
          <span class="result-icon">üìä</span>
          <span id="result-title">Resumo da Convers√£o</span>
        </div>
        <div id="resultadoEnvioContent"></div>
      </div>
    </div>

    <!-- Aba 2: Valor do produto em d√≥lar -->
    <div id="produto" class="tab-content" role="tabpanel">
      <div class="card">
        <div class="input-group">
          <label for="valorUSD">Valor do produto</label>
          <div class="input-container">
            <span class="currency-symbol">US$</span>
            <input type="number" id="valorUSD" class="currency-input" placeholder=" 100,00" min="0" step="0.01" />
          </div>
          <div class="error-message" id="error-valorUSD">Por favor, insira um valor v√°lido maior que zero.</div>
        </div>

        <div class="input-group">
          <label for="cotacaoProduto">Cota√ß√£o do d√≥lar</label>
          <div class="input-container">
            <span class="currency-symbol">R$</span>
            <input type="text" id="cotacaoProduto" class="currency-input" value="5.36" />
            <button type="button" id="refreshCotacaoProduto" class="refresh-btn" onclick="buscarCotacaoDolarProduto()" title="Atualizar cota√ß√£o do d√≥lar">
              üîÑ
            </button>
          </div>
          <div class="error-message" id="error-cotacaoProduto">Por favor, insira uma cota√ß√£o v√°lida maior que zero.</div>
        </div>
        
        <button class="calculate-btn" onclick="calcularProduto()">
          üõí Calcular Compra
        </button>
      </div>

      <div class="result" id="resultadoProduto" style="display: none;">
        <div class="result-header">
          <span class="result-icon">üõí</span>
          C√°lculo da Compra
        </div>
        <div id="resultadoProdutoContent"></div>
      </div>
    </div>

    <div class="footer">
      <p>Calculadora desenvolvida por Victor C.</p>
    </div>
  </div>

  <script>
    // Detectar se est√° rodando como PWA no iOS
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    const isStandalone = window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches;
    
    // Corre√ß√µes para iOS PWA
    if (isIOS && isStandalone) {
      // For√ßar viewport correto
      const viewport = document.querySelector('meta[name="viewport"]');
      if (viewport) {
        viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover');
      }
      
      // Adicionar padding para notch no iOS
      document.documentElement.style.setProperty('--sat', 'env(safe-area-inset-top)');
      document.documentElement.style.setProperty('--sab', 'env(safe-area-inset-bottom)');
      document.documentElement.style.setProperty('--sal', 'env(safe-area-inset-left)');
      document.documentElement.style.setProperty('--sar', 'env(safe-area-inset-right)');
    }
    
    // PWA Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/CalculadoraWise/sw.js')
          .then((registration) => {
            console.log('SW registrado: ', registration);
          })
          .catch((registrationError) => {
            console.log('SW falhou: ', registrationError);
          });
      });
    }
    
    // Configurar inputs quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ Conversor Wise carregado');
      setupIOSInputHandling();
      
      // Detectar estado online/offline
      window.addEventListener('online', function() {
        mostrarNotificacao('üåê Conectado √† internet', 'success');
      });
      
      window.addEventListener('offline', function() {
        mostrarNotificacao('üì° Modo offline ativo', 'error');
      });
      
      // Verificar se est√° offline no carregamento
      if (!navigator.onLine) {
        mostrarNotificacao('üì° Modo offline ativo', 'error');
      }
      
      // Carregar cota√ß√£o salva se dispon√≠vel
      const cotacaoSalva = localStorage.getItem('ultimaCotacao');
      const ultimaAtualizacao = localStorage.getItem('ultimaAtualizacao');
      
      if (cotacaoSalva && ultimaAtualizacao) {
        const dataSalva = new Date(ultimaAtualizacao);
        const agora = new Date();
        const diferencaHoras = (agora - dataSalva) / (1000 * 60 * 60);
        
        // Usar cota√ß√£o salva se tiver menos de 24 horas
        if (diferencaHoras < 24) {
          document.getElementById('cotacaoEnvio').value = cotacaoSalva;
          document.getElementById('cotacaoProduto').value = cotacaoSalva;
          console.log('Cota√ß√£o carregada do cache:', cotacaoSalva);
        }
      }
      
      // Buscar cota√ß√£o do d√≥lar automaticamente ao carregar a p√°gina (comentado para evitar erros)
      // setTimeout(() => {
      //   buscarCotacaoDolar();
      //   buscarCotacaoDolarProduto();
      // }, 1000);
      
      // Corre√ß√£o adicional para PWA no iOS
      if (isIOS && isStandalone) {
        // For√ßar teclado num√©rico em todos os inputs
        const inputs = document.querySelectorAll('input[type="number"]');
        inputs.forEach(input => {
          // Adicionar evento espec√≠fico para PWA
          input.addEventListener('touchend', function(e) {
            e.preventDefault();
            this.focus();
            // For√ßar teclado num√©rico
            this.setAttribute('inputmode', 'decimal');
          });
        });
      }
    });

    // PWA Install Prompt
    let deferredPrompt;
    const installButton = document.createElement('button');
    installButton.textContent = 'üì± Instalar App';
    installButton.className = 'calculate-btn';
    installButton.style.marginTop = '20px';
    installButton.style.display = 'none';
    installButton.onclick = installPWA;

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installButton.style.display = 'block';
      document.querySelector('.footer').appendChild(installButton);
    });

    async function installPWA() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
          console.log('Usu√°rio aceitou a instala√ß√£o');
          installButton.style.display = 'none';
        }
        deferredPrompt = null;
      }
    }

    // Fun√ß√£o para validar entrada
    function validateInput(value, min = 0) {
      const num = parseFloat(value);
      return !isNaN(num) && num >= min;
    }
    
    // Fun√ß√£o para melhorar experi√™ncia de input no iOS
    function setupIOSInputHandling() {
      if (isIOS) {
        const inputs = document.querySelectorAll('input[type="number"]');
        inputs.forEach(input => {
          // For√ßar teclado num√©rico
          input.setAttribute('inputmode', 'decimal');
          input.setAttribute('pattern', '[0-9]*');
          
          // Melhorar foco no iOS PWA
          input.addEventListener('focus', function() {
            // For√ßar scroll para o input
            setTimeout(() => {
              this.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
            
            // For√ßar foco novamente para garantir que o teclado apare√ßa
            setTimeout(() => {
              this.focus();
            }, 200);
          });
          
          // Corre√ß√£o espec√≠fica para PWA no iOS
          input.addEventListener('touchstart', function(e) {
            e.preventDefault();
            this.focus();
          });
          
          // Corre√ß√£o adicional para PWA
          input.addEventListener('click', function(e) {
            e.preventDefault();
            this.focus();
          });
          
          // For√ßar teclado num√©rico no iOS
          input.addEventListener('input', function() {
            // Garantir que apenas n√∫meros sejam aceitos
            this.value = this.value.replace(/[^0-9.,]/g, '');
          });
        });
      }
    }

    // Fun√ß√£o para mostrar/ocultar erro
    function showError(inputId, show) {
      const input = document.getElementById(inputId);
      const error = document.getElementById(`error-${inputId}`);
      
      if (show) {
        input.classList.add('error');
        error.style.display = 'block';
      } else {
        input.classList.remove('error');
        error.style.display = 'none';
      }
    }

    function openTab(tabId) {
      document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
        btn.setAttribute('aria-selected', 'false');
      });
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      
      const activeButton = document.querySelector(`.tab-button[onclick="openTab('${tabId}')"]`);
      activeButton.classList.add('active');
      activeButton.setAttribute('aria-selected', 'true');
      document.getElementById(tabId).classList.add('active');
    }

    let conversionType = 'brl-to-usd';

    function formatCurrency(value, currency = 'BRL') {
      if (isNaN(value) || value < 0) return 'R$ 0,00';
      
      return new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: currency,
        minimumFractionDigits: 2
      }).format(value);
    }

    function setConversionType(type) {
      conversionType = type;
      
      // Atualizar bot√µes
      document.querySelectorAll('.conversion-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById(type).classList.add('active');
      
      // Mostrar/ocultar campos
      const inputBrlToUsd = document.getElementById('input-brl-to-usd');
      const inputUsdToBrl = document.getElementById('input-usd-to-brl');
      const resultTitle = document.getElementById('result-title');
      
      if (type === 'brl-to-usd') {
        inputBrlToUsd.style.display = 'block';
        inputUsdToBrl.style.display = 'none';
        resultTitle.textContent = 'Enviando Reais';
        // Limpar campo USD
        document.getElementById('valorUSDDesejado').value = '';
        showError('valorUSDDesejado', false);
      } else {
        inputBrlToUsd.style.display = 'none';
        inputUsdToBrl.style.display = 'block';
        resultTitle.textContent = 'Valor a Enviar';
        // Limpar campo BRL
        document.getElementById('valorBRL').value = '';
        showError('valorBRL', false);
      }
      
      // Ocultar resultado ao trocar de modo
      document.getElementById('resultadoEnvio').style.display = 'none';
    }

    function calcularConversao() {
      if (conversionType === 'brl-to-usd') {
        calcularEnvio();
      } else {
        calcularUsdToBrl();
      }
    }

    function calcularEnvio() {
      const brl = parseFloat(document.getElementById("valorBRL").value);
      let cotacaoRaw = document.getElementById("cotacaoEnvio").value.trim();
      cotacaoRaw = cotacaoRaw.replace(',', '.').replace(/[^0-9.]/g, '');
      const cotacao = parseFloat(cotacaoRaw);

      // Valida√ß√£o
      const isValidBrl = validateInput(brl);
      const isValidCotacao = validateInput(cotacao, 0.01);

      showError('valorBRL', !isValidBrl);
      showError('cotacaoEnvio', !isValidCotacao);

      const resultDiv = document.getElementById("resultadoEnvio");
      const contentDiv = document.getElementById("resultadoEnvioContent");

      if (!isValidBrl || !isValidCotacao) {
        resultDiv.style.display = 'none';
        return;
      }

      // Atualiza o campo com o valor normalizado
      document.getElementById("cotacaoEnvio").value = cotacao.toFixed(2);

      const iof = brl * 0.011;
      const taxaWise = brl * 0.01737;
      const valorConvertido = (brl - iof - taxaWise) / cotacao;

      contentDiv.innerHTML = `
        <div class="result-item">
          <span class="result-label">Valor enviado</span>
          <span class="result-value">${formatCurrency(brl)}</span>
        </div>
        <div class="result-item">
          <span class="result-label">IOF (1,1%)</span>
          <span class="result-value">-${formatCurrency(iof)}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Taxa Wise (~1,74%)</span>
          <span class="result-value">-${formatCurrency(taxaWise)}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Total de descontos</span>
          <span class="result-value">-${formatCurrency(iof + taxaWise)}</span>
        </div>
        <div class="result-final">
          <div class="result-final-label">Voc√™ receber√°</div>
          <div class="result-final-value">${formatCurrency(valorConvertido, 'USD')}</div>
        </div>
      `;
      resultDiv.style.display = 'block';
    }

    function calcularUsdToBrl() {
      const usdDesejado = parseFloat(document.getElementById("valorUSDDesejado").value);
      let cotacaoRaw = document.getElementById("cotacaoEnvio").value.trim();
      cotacaoRaw = cotacaoRaw.replace(',', '.').replace(/[^0-9.]/g, '');
      const cotacao = parseFloat(cotacaoRaw);

      // Valida√ß√£o
      const isValidUsd = validateInput(usdDesejado);
      const isValidCotacao = validateInput(cotacao, 0.01);

      showError('valorUSDDesejado', !isValidUsd);
      showError('cotacaoEnvio', !isValidCotacao);

      const resultDiv = document.getElementById("resultadoEnvio");
      const contentDiv = document.getElementById("resultadoEnvioContent");

      if (!isValidUsd || !isValidCotacao) {
        resultDiv.style.display = 'none';
        return;
      }

      // Atualiza o campo com o valor normalizado
      document.getElementById("cotacaoEnvio").value = cotacao.toFixed(2);

      // Calcular quanto em BRL precisa enviar para ter o valor desejado em USD
      const taxaWise = 0.01737;
      const iof = 0.011;
      const brlNecessario = usdDesejado * cotacao / (1 - taxaWise - iof);

      const iofValue = brlNecessario * iof;
      const taxaWiseValue = brlNecessario * taxaWise;

      contentDiv.innerHTML = `
        <div class="result-item">
          <span class="result-label">Valor desejado</span>
          <span class="result-value">${formatCurrency(usdDesejado, 'USD')}</span>
        </div>
        <div class="result-item">
          <span class="result-label">IOF (1,1%)</span>
          <span class="result-value">${formatCurrency(iofValue)}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Taxa Wise (~1,74%)</span>
          <span class="result-value">${formatCurrency(taxaWiseValue)}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Total de custos</span>
          <span class="result-value">${formatCurrency(iofValue + taxaWiseValue)}</span>
        </div>
        <div class="result-final">
          <div class="result-final-label">Voc√™ deve enviar</div>
          <div class="result-final-value">${formatCurrency(brlNecessario)}</div>
        </div>
      `;
      resultDiv.style.display = 'block';
    }

    function calcularProduto() {
      const usd = parseFloat(document.getElementById("valorUSD").value);
      let cotacaoRaw = document.getElementById("cotacaoProduto").value.trim();
      cotacaoRaw = cotacaoRaw.replace(',', '.').replace(/[^0-9.]/g, '');
      const cotacao = parseFloat(cotacaoRaw);

      // Valida√ß√£o
      const isValidUsd = validateInput(usd);
      const isValidCotacao = validateInput(cotacao, 0.01);

      showError('valorUSD', !isValidUsd);
      showError('cotacaoProduto', !isValidCotacao);

      const resultDiv = document.getElementById("resultadoProduto");
      const contentDiv = document.getElementById("resultadoProdutoContent");

      if (!isValidUsd || !isValidCotacao) {
        resultDiv.style.display = 'none';
        return;
      }

      // Atualiza o campo com o valor normalizado
      document.getElementById("cotacaoProduto").value = cotacao.toFixed(2);

      const salesTax = usd * 0.065;
      const totalUSD = usd + salesTax;
      const totalBRL = totalUSD * cotacao;

      const taxaWise = 0.01737;
      const iof = 0.011;
      const brlNecessario = totalUSD * cotacao / (1 - taxaWise - iof);

      contentDiv.innerHTML = `
        <div class="result-item">
          <span class="result-label">Valor do produto</span>
          <span class="result-value">${formatCurrency(usd, 'USD')}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Sales Tax (6,5%)</span>
          <span class="result-value">+${formatCurrency(salesTax, 'USD')}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Total com imposto</span>
          <span class="result-value">${formatCurrency(totalUSD, 'USD')}</span>
        </div>
        <div class="result-item">
          <span class="result-label">Em reais (se tiver saldo USD)</span>
          <span class="result-value">${formatCurrency(totalBRL)}</span>
        </div>
        <div class="highlight">
          <div class="highlight-title">üí∞ Valor para enviar via Wise</div>
          <div class="highlight-value">${formatCurrency(brlNecessario)}</div>
        </div>
      `;
      resultDiv.style.display = 'block';
    }

    // Fun√ß√£o para buscar cota√ß√£o do d√≥lar (vers√£o simplificada)
    async function buscarCotacaoDolar() {
      const btn = document.getElementById('refreshCotacao');
      const input = document.getElementById('cotacaoEnvio');
      
      // Adicionar anima√ß√£o de loading
      btn.classList.add('loading');
      btn.textContent = '‚è≥';
      btn.disabled = true;
      
      try {
        // Verificar se est√° online
        if (!navigator.onLine) {
          throw new Error('Sem conex√£o com a internet');
        }
        
        // Usar API mais confi√°vel
        const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
        const data = await response.json();
        
        if (data && data.rates && data.rates.BRL) {
          const cotacao = parseFloat(data.rates.BRL);
          input.value = cotacao.toFixed(2);
          console.log('Cota√ß√£o obtida:', cotacao);
          mostrarNotificacao('‚úÖ Cota√ß√£o atualizada: R$ ' + cotacao.toFixed(2), 'success');
          
          // Salvar cota√ß√£o no localStorage para uso offline
          localStorage.setItem('ultimaCotacao', cotacao.toFixed(2));
          localStorage.setItem('ultimaAtualizacao', new Date().toISOString());
        } else {
          throw new Error('Dados inv√°lidos da API');
        }
      } catch (error) {
        console.error('Erro ao buscar cota√ß√£o:', error);
        
        // Tentar usar cota√ß√£o salva no localStorage
        const cotacaoSalva = localStorage.getItem('ultimaCotacao');
        const ultimaAtualizacao = localStorage.getItem('ultimaAtualizacao');
        
        if (cotacaoSalva && ultimaAtualizacao) {
          const dataSalva = new Date(ultimaAtualizacao);
          const agora = new Date();
          const diferencaHoras = (agora - dataSalva) / (1000 * 60 * 60);
          
          // Usar cota√ß√£o salva se tiver menos de 24 horas
          if (diferencaHoras < 24) {
            input.value = cotacaoSalva;
            mostrarNotificacao('üì± Cota√ß√£o offline: R$ ' + cotacaoSalva, 'error');
          } else {
            mostrarNotificacao('‚ùå Cota√ß√£o desatualizada. Use valor manual.', 'error');
            if (!input.value) input.value = '5.36';
          }
        } else {
          mostrarNotificacao('‚ùå Erro ao buscar cota√ß√£o. Use valor manual.', 'error');
          if (!input.value) input.value = '5.36';
        }
      } finally {
        // Remover anima√ß√£o de loading
        btn.classList.remove('loading');
        btn.textContent = 'üîÑ';
        btn.disabled = false;
      }
    }
    
    async function buscarCotacaoDolarProduto() {
      const btn = document.getElementById('refreshCotacaoProduto');
      const input = document.getElementById('cotacaoProduto');
      
      // Adicionar anima√ß√£o de loading
      btn.classList.add('loading');
      btn.textContent = '‚è≥';
      btn.disabled = true;
      
      try {
        // Verificar se est√° online
        if (!navigator.onLine) {
          throw new Error('Sem conex√£o com a internet');
        }
        
        // Usar API mais confi√°vel
        const response = await fetch('https://api.exchangerate-api.com/v4/latest/USD');
        const data = await response.json();
        
        if (data && data.rates && data.rates.BRL) {
          const cotacao = parseFloat(data.rates.BRL);
          input.value = cotacao.toFixed(2);
          console.log('Cota√ß√£o obtida:', cotacao);
          mostrarNotificacao('‚úÖ Cota√ß√£o atualizada: R$ ' + cotacao.toFixed(2), 'success');
          
          // Salvar cota√ß√£o no localStorage para uso offline
          localStorage.setItem('ultimaCotacao', cotacao.toFixed(2));
          localStorage.setItem('ultimaAtualizacao', new Date().toISOString());
        } else {
          throw new Error('Dados inv√°lidos da API');
        }
      } catch (error) {
        console.error('Erro ao buscar cota√ß√£o:', error);
        
        // Tentar usar cota√ß√£o salva no localStorage
        const cotacaoSalva = localStorage.getItem('ultimaCotacao');
        const ultimaAtualizacao = localStorage.getItem('ultimaAtualizacao');
        
        if (cotacaoSalva && ultimaAtualizacao) {
          const dataSalva = new Date(ultimaAtualizacao);
          const agora = new Date();
          const diferencaHoras = (agora - dataSalva) / (1000 * 60 * 60);
          
          // Usar cota√ß√£o salva se tiver menos de 24 horas
          if (diferencaHoras < 24) {
            input.value = cotacaoSalva;
            mostrarNotificacao('üì± Cota√ß√£o offline: R$ ' + cotacaoSalva, 'error');
          } else {
            mostrarNotificacao('‚ùå Cota√ß√£o desatualizada. Use valor manual.', 'error');
            if (!input.value) input.value = '5.36';
          }
        } else {
          mostrarNotificacao('‚ùå Erro ao buscar cota√ß√£o. Use valor manual.', 'error');
          if (!input.value) input.value = '5.36';
        }
      } finally {
        // Remover anima√ß√£o de loading
        btn.classList.remove('loading');
        btn.textContent = 'üîÑ';
        btn.disabled = false;
      }
    }
    
    // Fun√ß√£o para mostrar notifica√ß√µes
    function mostrarNotificacao(mensagem, tipo) {
      // Remover notifica√ß√£o anterior se existir
      const notificacaoExistente = document.querySelector('.notificacao');
      if (notificacaoExistente) {
        notificacaoExistente.remove();
      }
      
      const notificacao = document.createElement('div');
      notificacao.className = `notificacao ${tipo}`;
      notificacao.textContent = mensagem;
      notificacao.style.cssText = `
        position: fixed;
        top: calc(20px + env(safe-area-inset-top, 0px));
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        z-index: 1000;
        animation: slideIn 0.3s ease;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        ${tipo === 'success' ? 'background: linear-gradient(135deg, #28a745 0%, #20c997 100%);' : 'background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);'}
      `;
      
      document.body.appendChild(notificacao);
      
      // Remover notifica√ß√£o ap√≥s 3 segundos
      setTimeout(() => {
        if (notificacao.parentNode) {
          notificacao.style.animation = 'slideOut 0.3s ease';
          setTimeout(() => notificacao.remove(), 300);
        }
      }, 3000);
    }
    
    // Adicionar anima√ß√µes CSS para notifica√ß√µes
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>